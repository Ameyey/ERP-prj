<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RMA Request Form</title>
  <link rel="stylesheet" href="hrms.css">
  <link rel="stylesheet" href="sty.css">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
</head>
<style>
h5{
  margin: 10px;
}

</style>
<body >

   <div class="form-container" style="max-width: 877px;" >
    <!-- Personal Information Section -->
    <input type="hidden" id="id" name="id" th:value="${stocktransfer?.id}">
    <div class="form-section active" id="section1">
      <input type="hidden" name="id" th:value="${warehouse?.id}" />
      <h2>Return Merchandise Authorization (RMA) Request Form</h2>

      <!-- First Row -->
        <div class="form-row">
        
        <div class="form-group">        
          <label for="customeruid">Customer UID *</label>
            <select id="customeruid" name="customeruid"  onchange="fetchCustDetails(this.value)" th:if="${rma == null or rma.id == null}" required >
				<option value="">--Select Customer UId--</option>
				<option th:each="custuid : ${customeruid}" th:value="${custuid}" th:text="${custuid}" ></option>					
			</select>
        </div>

       
        <div class="form-group">
          <label for="customername">Customer Name</label>
          <input type="text" id="customername" name="customername"  readonly>   
        </div>

        <div class="form-group" >
          <label for="phonenumber" style="font-size: 13px;">Customer Phone Number</label>
            <input type="text" id="phonenumber" name="phonenumber" readonly>
        </div>
        <div class="form-group">
          <label for="email">Customer Email</label>
            <input type="text" id="email" name="email" readonly>
        </div>
      </div>

      <!-- Second Row -->
          
      <div class="form-row">
        <div class="form-group">
          <label for=ordernumber>Order Number</label>
            <input type="text" id="ordernumber" name="ordernumber" readonly>
	      </div>

       
   
        <div class="form-group">
          <label for="itemuid">Item UID *</label>
            <select id="itemuid" name="itemuid"  onchange="fetchItemDetails(this.value)" th:if="${rma == null or rma.id == null}" required>
				    <option value=""> Select Item UId:</option>
				    <option th:each="uid : ${itemuid}" th:value="${uid}" th:text="${uid}" ></option>					
			     </select>
        </div> 
        <div class="form-group" >
          <label for="itemname">Item Name</label>
            <input type="text" id="itemname" name="itemname" readonly>
        </div>     
        
        <div class="form-group">
          <label for="itemsku">Item SKU</label>
            <input type="text" id="itemsku" name="itemsku" readonly>
        </div>
        
      </div>
      <!-- Third Row -->
      
      <div class="form-row">
      
          <div class="form-group">            
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" name="quantity" readonly>
          </div>

          <div class="form-group">
            <label for="returnuid">Return UID *</label>
            <select id="returnuid" name="returnuid"  onchange="fetchReturnDetails(this.value)" th:if="${rma == null or rma.id == null}" required>
					<option value=""> Select Product Id:</option>
					<option th:each="uid :${returnuid}" th:value="${uid}" th:text="${uid}" ></option>					
			</select>   
        </div>
        <!-- <div class="form-group">
          <br>
          <input type="text" id="returnuid" name="returnuid" th:value="${rma?.returnuid}" onchange="fetchReturnDetails(this.value)" readonly th:if="${rma?.id != null}">
        </div> -->

        <div class="form-group">
          <label for="reasonforreturn">Reason for Return</label>
          <input type="text" id="reasonforreturn" name="reasonforreturn" readonly></input>     
        </div>
        <div class="form-group">
          <label for="dateofreturnrequest">Date of Return Request</label>
          <!-- <input type="date" id="dateofreturnrequest" name="dateofreturnrequest" readonly />   -->
          <input type="date" id="dateofreturnrequest" name="dateofreturnrequest"  required>
        </div>
      </div>

      <!-- four Row -->

    
      <div class="form-row">
        <div class="form-group">
          <label for="supportingevidence">Supporting Evidence</label>
          <input type="text" id="supportingevidence" name="supportingevidence">
        </div> 
        <div class="form-group">
          <label for="approvalstatus">Approval Status *</label>
          <select id="approvalstatus" name="approvalstatus" th:value="${rma?.approvalstatus}" required>
              <option value="">Select status</option>
              <option value="Accepted" th:selected="${rma?.approvalstatus == 'Accepted'}">Accepted</option>
              <option value="Rejected" th:selected="${rma?.approvalstatus == 'Rejected'}">Rejected</option>
          </select>
        </div>     
        <div class="form-group">
          <label for="returninstructions">Return Instructions</label>
          <input type="text" id="returninstructions" name="returninstructions" th:value="${rma?.returninstructions}">
        </div>   
        <div class="form-group">
          <label for="restockingfee">Restocking Fee</label>
          <input type="number" id="restockingfee" name="restockingfee" th:value="${rma?.restockingfee}">  
        </div>
      </div>

   
   <div class="form-row">
     <div class="form-group">
      <label for="processedby">Processed By *</label>
      <input type="text" id="processedby" name="processedby" th:value="${rma?.processedby}" required>
     </div>

     <div class="form-group">
      <label for="decisiondate">Decision Date</label>
      <input type="date" id="decisiondate" name="decisiondate" th:value="${rma?.decisiondate}" required>
     </div>  

     <div class="form-group">
      <label for="returntrakingnumber">Return Tracking Number</label>
      <input type="text" id="returntrakingnumber" name="returntrakingnumber" th:value="${rma?.returntrakingnumber}" required>
      
     </div>
   </div>  

  


      <div class="form-actions">
        <button type="button" id="submitBtn" onclick="submitForm()">Submit</button>		
		<div th:if="${successMessage}" class="success-message" th:text="${successMessage}"></div>                     
      </div>
    </div>





   </div>






  

  <script>
    function nextSection(current) {
      document.getElementById(`section${current}`).classList.remove('active');
      document.getElementById(`section${current + 1}`).classList.add('active');
    }

    function prevSection(current) {
      document.getElementById(`section${current}`).classList.remove('active');
      document.getElementById(`section${current - 1}`).classList.add('active');
    }
  </script>
<script>
  //Data fetch from CustDetails Table to RMA Request Form
   $(document).ready(function() {
       // Auto-fill customer details when updating
       var existingCustomerUid = $('#customeruid').val();
       if (existingCustomerUid) {
           fetchCustDetails(existingCustomerUid);
       }
   });
   
   function fetchCustDetails(customeruid) {
       if (!customeruid) return;
   
       $.ajax({
           url: '/custdetails', // Endpoint to fetch data
           method: 'GET',
           data: { customeruid: customeruid },
           success: function(response) {
               // Populate response data into form fields
               $('#customername').val(response.customername);
               $('#email').val(response.email);
               $('#phonenumber').val(response.phonenumber);
               $('#ordernumber').val(response.ordernumber);
           },
           error: function() {
               alert('Error fetching customer details');
           }
       });
   }
</script>
 
   <script>
   $(document).ready(function() {
     // Auto-fill Item details when updating
     var existingItemUid = $('#itemuid').val();
     if (existingItemUid) {
       fetchItemDetails(existingItemUid);
     }
 });
 //Data fetch from Item Details Table to  RMA Request Form
 function fetchItemDetails(itemuid) {
     if (!itemuid) return;

     $.ajax({
         url: '/itemdetailsrma', // Endpoint to fetch data
         method: 'GET', // HTTP method
         data: { itemuid: itemuid }, // Query parameter to be sent to the server
         success: function(response) {
             // Populate response data into form fields
             $('#itemname').val(response.itemname);
             $('#itemsku').val(response.itemsku);
             $('#quantity').val(response.quantity);
             },
     error:function(){
       alert('Error occur');
     }
     });
 }
 
 $(document).ready(function() {
     // Auto-fill Return details when updating
     var existingReturnUid = $('#returnuid').val();
     if (existingReturnUid) {
       fetchReturnDetails(existingReturnUid);
     }
 });
 //Data fetch from Return Details Table to RMA Request Form
 function fetchReturnDetails(returnuid) {
     if (!returnuid) return;

     $.ajax({
         url: '/returndetails', // Endpoint to fetch data
         method: 'GET', // HTTP method
         data: { returnuid: returnuid }, // Query parameter to be sent to the server
         success: function(response) {
             // Populate response data into form fields
             $('#reasonforreturn').val(response.reasonforreturn);
             $('#dateofreturnrequest').val(response.dateofreturnrequest);
             $('#supportingevidence').val(response.supportingevidence);
             },
     error:function(){
       alert('Error occur');
     }
     });
 }
   </script>
   <script>

 function submitForm() {
       let form = document.getElementById('rmarequest');
       
       if (!form.checkValidity()) {
           alert('Please fill in all required fields.');
           return;
       }

     const formData = new FormData(document.getElementById('rmarequest'));
     const id = $('#id').val();

     let url, successMessage;

     if (!id) {
         url = '/addrmarequest';
         successMessage = 'RMA Request Form Details saved successfully!';
     } else {
         url = '/updaterequestform';
         successMessage = 'Stock Dispatch Details updated successfully!';
     }

     $.ajax({
         url: url,
         type: 'POST',
         data: formData,
         processData: false,
         contentType: false,
         success: function(response) {
             $('#message').text(successMessage); // Display success message
             resetForm();
             window.location.href = '/viewrmarequestlist';
         },
         error: function() {
             alert('Error saving RMA Request Form. Please fill out the data.');
         }
     });
 }
 // Reset the form
 function resetForm() {
         $('#rmarequest')[0].reset();
       $('#id').val('');
         $('#message').text(''); // Clear the message
         $('#submitBtn').text('Submit');
 }
     
 function prefillForm(data) {
             $('#id').val(data.id);		      
             $('#customeruid').val(data.customeruid);
             $('#itemuid').val(data.itemuid);
             $('#returnuid').val(data.returnuid);
             $('#approvalstatus').val(data.approvalstatus);
             $('#returninstructions').val(data.returninstructions);
             $('#restockingfee').val(data.restockingfee);
             $('#processedby').val(data.processedby);
             $('#decisiondate').val(data.decisiondate);
             $('#returntrakingnumber').val(data.returntrakingnumber);
             
            
         $('#form-title').text('Updated RMA Request Form');
         $('#submitBtn').text('Update');
         
 }
 
 document.getElementById('submitBtn').addEventListener('click', function () {
     let requiredFields = document.querySelectorAll('#rmarequest [required]');
     let isValid = true;

     requiredFields.forEach(field => {
         if (!field.value.trim()) {
             field.style.border = '2px solid red';
             isValid = false;
         } else {
             field.style.border = '1px solid #ccc';
         }
     });

     if (isValid) {
         submitForm();
     } else {
         alert('Please fill in all required fields.');
     }
 });
 
</script>


</body>
</html>
