<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supplier Registration Form</title>
  <link rel="stylesheet" href="hrms.css">
  <link rel="stylesheet" href="sty.css">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
</head>

<body onload="fetchProductDetails(this.value)"> 

   <form id="supplierForm"  class="form-container"  >
    <!-- Personal Information Section -->
    <input type="hidden" id="id" name="id" th:value="${supplierlist?.id}">
    <div class="form-section active" id="section1">
      <h2>Supplier Registration Form</h2>

      <!-- First Row -->
    
      <div class="form-row">
        
        <div class="form-group">        
          <label for="suppliername">Supplier Name *</label>
          <input type="text" id="suppliername" name="suppliername" th:value="${supplierlist?.suppliername}" required>
        </div>

        <div class="form-group">
          <label for="suppliertype">Supplier Type *</label>
            <select id="suppliertype" name="suppliertype" th:value="${supplierlist?.suppliertype}" required>
                <option value="">Select Type</option>
                <option value="Manufacturer" th:selected="${supplierlist?.suppliertype == 'Manufacturer'}">Manufacturer</option>
                <option value="Distributor" th:selected="${supplierlist?.suppliertype == 'Distributor'}">Distributor</option>
                <option value="Wholesaler" th:selected="${supplierlist?.suppliertype == 'Wholesaler'}">Wholesaler</option>
            </select>
        </div>

        <div class="form-group">
          <label for="bussinessregno">Business Registration Number *</label>
            <input type="text" id="bussinessregno" name="bussinessregno" th:value="${supplierlist?.bussinessregno}" required> 
        </div>

        

      </div>

      <!-- Second Row -->
      <div class="form-row">
        <div class="form-group">
          <label for="contactperson">Primary Contact Person *</label>
            <input type="text" id="contactperson" name="contactperson" th:value="${supplierlist?.contactperson}" required>
      </div>
        <div class="form-group">
          <label for=contactnumber>Contact Number *</label>
          <input type="tel" id="contactnumber" name="contactnumber" th:value="${supplierlist?.contactnumber}" max="10" required>
	      </div>
   
        <div class="form-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" name="email" th:value="${supplierlist?.email}" required>
        </div>

       
      </div>
      <!-- Third Row -->
      <div class="form-row">
        <div class="form-group">
          <label for="companywebsite">Company Website</label>
          <input type="text" id="companywebsite" name="companywebsite" th:value="${supplierlist?.companywebsite}">
        </div>

        <div class="form-group" >         
          <label for="headofficeaddress">Head Office Address *</label>
          <input type="text"  id="headofficeaddress" name="headofficeaddress" th:value="${supplierlist?.headofficeaddress}" required>
        </div>
      
          <div class="form-group">            
            <label for="warehouseaddress">Warehouse Address</label>
            <input type="text" id="warehouseaddress" name="warehouseaddress" th:value="${supplierlist?.warehouseaddress}" >
          </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="bankname">Bank Name *</label>
          <input type="text" id="bankname" name="bankname" th:value="${supplierlist?.bankname}" required>
         </div>

        <div class="form-group">
          <label for="bankaccountnumber">Bank Account Number *</label>
            <input type="text" id="bankaccountnumber" name="bankaccountnumber" th:value="${supplierlist?.bankaccountnumber}" required>
        </div>

        <div class="form-group">
          <label for="taxidnumber">Tax Identification Number (TIN) *</label>
          <input type="text" id="taxidnumber" name="taxidnumber" th:value="${supplierlist?.taxidnumber}" required>              
        </div>
      </div>

      <!-- four Row -->

      <div class="form-row">
        <div class="form-group">
          <label for="paymentterms">Payment Terms *</label>
             <select id="paymentterms" name="paymentterms" th:value="${supplierlist?.paymentterms}" required>
                <option value="">Select Type</option>
                <option value="Net" th:selected="${supplierlist?.paymentterms == 'Net'}">Net 30</option>
				<option value="AdvancePayment" th:selected="${supplierlist?.paymentterms == 'AdvancePayment'}">Advance Payment</option>
                <option value="other" th:selected="${supplierlist?.paymentterms == 'other'}">Other</option>
            </select>
        </div>

        <div class="form-group">
          <label for="approvedby">Approved By *</label>
          <select id="approvedby" name="approvedby" th:value="${supplierlist?.approvedby}" required>
              <option value="">Select Approver</option>
              <option value="Manager" th:selected="${supplierlist?.approvedby == 'Manager'}">Manager</option>
              <option value="HR" th:selected="${supplierlist?.approvedby == 'HR'}">HR</option>
          </select>
        </div> 

        <div class="form-group">
          <label for="approvaldate">Approval Date *</label>
          <input type="date" id="approvaldate" name="approvaldate" th:value="${supplierlist?.approvaldate}" required>

     </div>
         
      
      
        
    </div>

   <!-- Five Row  -->
 <div class="form-row">
 <div class="form-group">
  <label for="approvalstatus">Status *</label>
  <select id="approvalstatus" name="approvalstatus" th:value="${supplierlist?.approvalstatus}" required>
      <option value="">Select Status</option>
      <option value="Active" th:selected="${supplierlist?.approvalstatus == 'Active'}">Active</option>
<option value="Pending" th:selected="${supplierlist?.approvalstatus == 'Pending'}">Pending</option>
<option value="Rejected" th:selected="${supplierlist?.approvalstatus == 'Rejected'}">Rejected</option>
  </select>
 </div> 
 </div>

 


    <div class="form-actions">
      <button type="button" id="submitBtn" onclick="submitForm()">Submit</button>
		  <button type="button" class="back-button" th:href="@{/}">Back to Dashboard</button>
			<div th:if="${successMessage}" class="success-message" th:text="${successMessage}"></div>              
    </div>
  







   </form>



   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script>
	 

    function submitForm() {
         let form = document.getElementById('supplierForm');
 
         if (!form.checkValidity()) {
             alert('Please fill in all required fields.');
             return;
         }
 
         const email = document.getElementById("email").value;
         const id = document.getElementById("id").value; // Get the ID for update case
 
         // Check if email exists in the database
         $.ajax({
             url: "/checkEmailExists",
             type: "GET",
             data: { email: email, id: id }, // Pass the id to the backend
             success: function(response) {
                 if (response === "exists") {
                     alert("Supplier with this email already exists!"); // Show popup if email exists
                 } else {
                     // Confirmation before saving
                     if (confirm("Are you sure you want to save this supplier information?")) {
                         saveSupplier(); // Call the save function
                     }
                 }
             },
             error: function() {
                 alert("Error checking email. Please try again.");
             }
         });
     }
 
 
     function saveSupplier() {
         const formData = new FormData(document.getElementById('supplierForm'));
         const id = $('#id').val();
 
         let url, successMessage;
 
         if (!id) {
             url = '/addnewsupplier';
             successMessage = 'Supplier Registration Form Details saved successfully!';
         } else {
             url = '/updatesupplierform';
             successMessage = 'Supplier Registration Form Details updated successfully!';
         }
 
         $.ajax({
             url: url,
             type: 'POST',
             data: formData,
             processData: false,
             contentType: false,
             success: function(response) {
                 alert(successMessage);
                 resetForm();
                 window.location.href = '/viewsupplierlist';
             },
             error: function() {
                 alert('Error saving Supplier Registration Form. Please fill out the data.');
             }
         });
     }
 
   // Reset the form
   function resetForm() {
           $('#supplierForm')[0].reset();
         $('#id').val('');
           $('#message').text(''); // Clear the message
           $('#submitBtn').text('Submit');
   }
       
   function prefillForm(data) {
               $('#id').val(data.id);		      
               $('#supplieruid').val(data.supplieruid);
               $('#supplierName').val(data.supplierName);
               $('#suppliertype').val(data.suppliertype);
               $('#bussinessregno').val(data.bussinessregno);
               $('#contactperson').val(data.contactperson);
               $('#contactnumber').val(data.contactnumber);
               $('#email').val(data.email);
               $('#companywebsite').val(data.companywebsite);
               $('#headofficeaddress').val(data.headofficeaddress);
               $('#warehouseaddress').val(data.warehouseaddress);	
               $('#bankname').val(data.bankname);	
               $('#bankaccountnumber').val(data.bankaccountnumber);
               $('#taxidnumber').val(data.taxidnumber);	
               $('#paymentterms').val(data.paymentterms);	
               $('#approvedby').val(data.approvedby);	
               $('#approvaldate').val(data.approvaldate);	
               $('#approvalstatus').val(data.approvalstatus);	
           $('#form-title').text('Updated Audit Form');
           $('#submitBtn').text('Update');
           
   }		
 </script>
 
 <script>
 document.addEventListener("DOMContentLoaded", function () {
     function showError(input, message) {
         let errorSpan = input.nextElementSibling;
         if (!errorSpan || !errorSpan.classList.contains("error-message")) {
             errorSpan = document.createElement("span");
             errorSpan.classList.add("error-message");
             input.parentNode.insertBefore(errorSpan, input.nextSibling);
         }
         errorSpan.innerText = message;
         errorSpan.style.display = "block";
     }
 
     function clearError(input) {
         let errorSpan = input.nextElementSibling;
         if (errorSpan && errorSpan.classList.contains("error-message")) {
             errorSpan.style.display = "none";
         }
     }
 
     // Email validation on blur
     document.getElementById("email").addEventListener("blur", function () {
         const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
         if (this.value.trim() !== "" && !emailRegex.test(this.value)) {
             showError(this, "Please enter a valid email address.");
         } else {
             clearError(this);
         }
     });
 
     // Function to validate text input (only letters and spaces allowed)
     function validateTextInput(input) {
         const regex = /^[A-Za-z\s]+$/;
         if (!regex.test(input.value)) {
             showError(input, "Please enter only letters.");
             input.value = input.value.replace(/[^A-Za-z\s]/g, ""); 
         } else {
             clearError(input);
         }
     }
 
     // Attach validation functions to respective fields
     document.getElementById("suppliername").addEventListener("input", function () {
         validateTextInput(this);
     });
 
     document.getElementById("bankname").addEventListener("input", function () {
         validateTextInput(this);
     });
 
 });
 </script>
 
 <script>
 document.addEventListener("DOMContentLoaded", function () {
     
     function validateNumberInput(input, minLength, maxLength) { 
         input.addEventListener("input", function () {
             let errorMessage = "";
 
             if (/\D/.test(this.value)) { 
                 errorMessage = "Only numbers are allowed.";
                 this.value = this.value.replace(/\D/g, ""); // Remove non-numeric characters
             }
 
             if (this.value.length > maxLength) {
                 errorMessage = `Maximum allowed length is ${maxLength} digits.`;
                 this.value = this.value.slice(0, maxLength);
             } 
 
             if (this.value.length > 0 && this.value.length < minLength) {
                 errorMessage = `Minimum required length is ${minLength} digits.`;
             }
 
             if (errorMessage) {
                 showError(this, errorMessage);
             } else {
                 clearError(this);
             }
         });
 
         input.addEventListener("blur", function () {
             if (this.value.length > 0 && this.value.length < minLength) {
                 showError(this, `Minimum required length is ${minLength} digits.`);
             } else {
                 clearError(this);
             }
         });
     }
 
     // Function to display error message below input
     function showError(input, message) {
         let errorSpan = input.nextElementSibling;
         if (!errorSpan || !errorSpan.classList.contains("error-message")) {
             errorSpan = document.createElement("span");
             errorSpan.className = "error-message";
             errorSpan.style.color = "red";
             errorSpan.style.fontSize = "12px";
             input.parentNode.insertBefore(errorSpan, input.nextSibling);
         }
         errorSpan.innerText = message;
     }
 
     // Function to clear error message
     function clearError(input) {
         let errorSpan = input.nextElementSibling;
         if (errorSpan && errorSpan.classList.contains("error-message")) {
             errorSpan.innerText = "";
         }
     }
 
     // Apply validation for numeric fields
     validateNumberInput(document.getElementById("contactnumber"), 10, 10);
     validateNumberInput(document.getElementById("bankaccountnumber"), 8, 15);
     validateNumberInput(document.getElementById("taxidnumber"), 9, 10);
 
 });
 </script>
  


</body>
</html>
