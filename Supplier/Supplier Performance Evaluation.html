<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supplier Performance Evaluation</title>
  <link rel="stylesheet" href="hrms.css">
  <link rel="stylesheet" href="sty.css">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
                                                                        
    
   <form  id="supplierperformanceForm"   class="form-container">
    <!-- Personal Information Section -->
    <input type="hidden" id="id" name="id" th:value="${supplier?.id}" >
    <h2>Supplier Performance Evaluation</h2>   
    <div class="form-section active" id="section1">
     

      <!-- First Row -->
    
      <div class="form-row" >
        <div class="form-group">
          <label>Supplier UID:</label>
          <select id="supplieruid" name="supplieruid" onchange="fetchSupplierDetails(this.value)" th:if="${supplier == null or supplier.id == null}">
              <option value="">Select Supplier UID</option>
              <option th:each="uid : ${supplieruid}" th:value="${uid}" th:text="${uid}"></option>
          </select>
          <input type="text" id="supplieruid_readonly" name="supplieruid" th:value="${supplier?.supplieruid}" readonly th:if="${supplier?.id != null}">              
        </div>
      
      <div class="form-group">
        <label>Supplier Name:</label>
			<input type="text" id="suppliername" name="suppliername" readonly>
    </div>

    <div class="form-group">
      <label>Evaluation Period:</label>
      <input type="month" id="evaluationperiod" name="evaluationperiod" th:value="${supplier?.evaluationperiod}" required>
    </div>
    
  
      </div>

      <!-- Second Row -->
      <div class="form-row">
        <div class="form-group">           
          <label>On-Time Delivery Rate (%):</label>
          <input type="number" id="ontimedeliveryrate" name="ontimedeliveryrate" th:value="${supplier?.ontimedeliveryrate}" min="0" max="100" step="0.01" required >
    
      </div>
    
        <div class="form-group">      
          <label>Quality Rating:</label>
          <input type="number" id="qualityrating" name="qualityrating" min="1" max="10" th:value="${supplier?.qualityrating}" required>
      </div>

      <div class="form-group">
        <label>Order Accuracy (%):</label>
        <input type="number" id="orderaccuracy" name="orderaccuracy" th:value="${supplier?.orderaccuracy}" min="0" max="100" step="0.01" required >
 <input type="text" id="pouid" name="pouid" th:value="${invoice?.pouid}" onchange="fetchPODetails(this.value)" readonly th:if="${invoice?.id != null}">

    </div>

    
    
       
    
      </div>
      <!-- Third Row -->
      <div class="form-row">

        <div class="form-group">
          <label>Responsiveness Score:</label>
          <input type="number" id="responsivenessscore" name="responsivenessscore" min="1" max="10" th:value="${supplier?.responsivenessscore}" required >
      </div>
    

        <div class="form-group">
        
          <label>Compliance Score:</label>
          <input type="number" id="compliancescore" name="compliancescore" min="1" max="10" th:value="${supplier?.compliancescore}" required >
      </div>
      
        <div class="form-group">
          <label>Overall Score:</label>
          <input type="text" id="overallscore" name="overallscore" th:value="${supplier?.overallscore}" required>
      </div>

          
      </div>

      <!-- four Row -->
      <div class="form-row">
        <div class="form-group">
         
          <label>Performance Status:</label>
          <select id="performancestatus" name="performancestatus" required>
      <option value="">Select status</option>
              <option value="Satisfactory" th:selected="${supplier?.performancestatus == 'Satisfactory'}">Satisfactory</option>
              <option value="Needs Improvement" th:selected="${supplier?.performancestatus == 'Needs Improvement'}">Needs Improvement</option>
              <option value="Unsatisfactory" th:selected="${supplier?.performancestatus == 'Unsatisfactory'}">Unsatisfactory</option>
          </select>
        </div>
        <div class="form-group">
          <label>Action Required:</label>
            <select id="actionrequired" name="actionrequired" required>
				<option value="">Select Action</option>
				<option value="Continue Partnership" th:selected="${supplier?.actionrequired == 'Continue Partnership'}">Continue Partnership</option>
                <option value="Probation" th:selected="${supplier?.actionrequired == 'Probation'}">Probation</option>
                <option value="Termination" th:selected="${supplier?.actionrequired == 'Termination'}">Termination</option>
            </select>
        </div>
        <div class="form-group">
          <label>Reviewed By:</label>
            <input type="text" id="reviewedby" name="reviewedby" th:value="${supplier?.reviewedby}" required >
        </div>
       
      
      </div>
      
      
   
    </div>

   <!-- Five Row  -->
   

 


    <div class="form-actions">
      <button type="button" id="submitBtn" onclick="submitForm()">Submit </button>
      <div th:if="${successMessage}" class="success-message" th:value="${successMessage}"></div>
     
    </div>
  







   </form>



   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script>
    $(document).ready(function() {
          // Auto-fill Supplier details when updating
          var supplieruid = $('#supplieruid').val();
          if (supplieruid) {
            fetchSupplierDetails(supplieruid);
          }
      });
     
    function fetchSupplierDetails(supplieruid) {
       if (!supplieruid) return;
        $.ajax({
      url: '/fetchSupplierDetails',
      method: 'GET',
      data: { supplieruid: supplieruid },
      success: function(response) {
      if (response) {
       $('#suppliername').val(response.suppliername);
       }
       },
        error: function() {
           alert('Error fetching supplier details. Please try again.');
        }
      });
    }
    
    
    
                
                        
    function resetSupplierPerformanceForm() {
        $('#supplierperformanceForm')[0].reset();
        $('#id').val('');
        $('#form-title').text('SupplierPerformance Evaluation');
        $('#submitBtn').text('Submit');
    }
    
    function supplierperformanceForm(data) {
      $('#id').val(data.id);
    
        $('#supplierperformanceuid').val(data.supplierperformanceuid);
        $('#supplieruid').val(data.supplieruid);
        $('#evaluationperiod').val(data.evaluationperiod);
        $('#ontimedeliveryrate').val(data.ontimedeliveryrate);
        $('#qualityrating').val(data.qualityrating);
        $('#orderaccuracy').val(data.orderaccuracy);
        $('#responsivenessscore').val(data.responsivenessscore);
        $('#compliancescore').val(data.compliancescore);
        $('#overallscore').val(data.overallscore);
        $('#performancestatus').val(data.performancestatus);
        $('#actionrequired').val(data.actionrequired);
        $('#reviewedby').val(data.reviewedby);
    
        $('#form-title').text('Update Supplierperformance Evaluation');
        $('#submitBtn').text('Update');
    }
    
    function submitForm() {
        const formData = new FormData(document.getElementById("supplierperformanceForm"));
        const id = $("#id").val();  // ✅ corrected
    
        let url, successMessage;
    
        if (!id) {
            url = "/supplierperformanceevaluation/save";
            successMessage = "Supplier Evaluation saved successfully!";
        } else {
            url = "/supplierperformanceevaluation/update";  // ✅ updated endpoint name
            successMessage = "Supplier Evaluation updated successfully!";
        }
    
        $.ajax({
            url: url,
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
    $('message').text(successMessage);
    resetSupplierPerformanceForm()           
     window.location.href = "/supplierperformanceevaluation/list";
            },
            error: function () {
                alert("Error saving Supplier Evaluation. Please try again.");
            }
        });
    }
      
    function validateForm() {
            // Trimmed input values
            let supplieruid = $('#supplieruid').val().trim() || $('#supplieruid_readonly').val().trim();
            let evaluationperiod = $('#evaluationperiod').val().trim();
            let ontimedeliveryrate = $('#ontimedeliveryrate').val().trim();
            let qualityrating = $('#qualityrating').val().trim();
            let orderaccuracy = $('#orderaccuracy').val().trim();
            let responsivenessscore = $('#responsivenessscore').val().trim();
            let compliancescore = $('#compliancescore').val().trim();
            let overallscore = $('#overallscore').val().trim();
            let performancestatus = $('#performancestatus').val().trim();
            let actionrequired = $('#actionrequired').val().trim();
            let reviewedby = $('#reviewedby').val().trim();
    
            // Required Fields Check
            if (
                !supplieruid || !evaluationperiod || !ontimedeliveryrate ||
                !qualityrating || !orderaccuracy || !responsivenessscore ||
                !compliancescore || !overallscore || !performancestatus ||
                !actionrequired || !reviewedby
            ) {
                alert("All fields are required. कृपया सर्व फील्ड्स भराव्यात.");
                return false;
            }
    
            // Numeric fields check
            const numericFields = {
                'On-Time Delivery Rate': ontimedeliveryrate,
                'Quality Rating': qualityrating,
                'Order Accuracy': orderaccuracy,
                'Responsiveness Score': responsivenessscore,
                'Compliance Score': compliancescore,
                'Overall Score': overallscore
            };
    
          for (let [name, value] of Object.entries(numericFields)) {
              if (isNaN(value)) {
                  alert(`${name} must be a valid number.`);
                  return false;
              }
          }
    
            
    
            // Alpha-only check for string fields
            const stringOnlyRegex = /^[A-Za-z\s]+$/;
    
            if (!stringOnlyRegex.test(performancestatus)) {
                alert("'Performance Status' must contain only letters and spaces.");
                return false;
            }
    
            if (!stringOnlyRegex.test(actionrequired)) {
                alert("'Action Required' must contain only letters and spaces.");
                return false;
            }
    
            if (!stringOnlyRegex.test(reviewedby)) {
                alert("'Reviewed By' must contain only letters and spaces.");
                return false;
            }
    
            return true;
        }
    
    
    
    
    </Script>
</body>
</html>
