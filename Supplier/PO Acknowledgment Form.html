<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PO Acknowledgment Form</title>
  <link rel="stylesheet" href="/css/empinfo.css">
  <link rel="stylesheet" href="/css/hrms.css"> 
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
</head>
<div th:replace="~{SUPPLIER.html :: sidebarFragment}"></div> <!-- // for side bar code  -->
<body>
                                                                        
    
   <form  id="POAcknowledgmentForm"  class="form-container">
    <!-- Personal Information Section -->
    <input type="hidden" id="id" name="id" th:value="${poAcknowledgment?.id}">
    <h2>PO Acknowledgment Form</h2>   
    <div class="form-section active" id="section1">
     

      <!-- First Row -->
    
      <div class="form-row" >
        <div class="form-group">
          <label for="poacknowledgmentuid">poAcknowledgment UID</label>
          <input type="text" id="poacknowledgmentuid" name="poacknowledgmentuid" th:value="${poAcknowledgment?.poacknowledgmentuid}" readonly />
  
        </div>
      
      <div class="form-group">
        <label for="supplieruid">Supplier UID *</label>
        <select id="supplieruid" name="supplieruid" onchange="fetchSupplierDetails(this.value)" th:if="${poAcknowledgment == null or poAcknowledgment.id == null}" required>
            <option value="">Select Supplier UID</option>
            <option th:each="uid : ${supplieruid}" th:value="${uid}" th:text="${uid}"></option>
        </select>
        <input type="text" id="supplieruid" name="supplieruid" th:value="${poAcknowledgment?.supplieruid}" readonly th:if="${poAcknowledgment?.id != null}">
        <span id="supplieruid-error" class="error-message"></span>
    </div>

    <div class="form-group">
      <label>Supplier Name *</label>
      <input type="text" id="suppliername" name="suppliername" readonly />
    </div>
    
  
      </div>

      <!-- Second Row -->
      <div class="form-row">
        <div class="form-group">           
          <label for="pouid">PO UID *</label>
          <select id="pouid" name="pouid" onchange="fetchPoDetails(this.value)" th:if="${poAcknowledgment == null or poAcknowledgment.id == null}" required>
              <option value="">Select PO UID</option>
              <option th:each="uid : ${pouid}" th:value="${uid}" th:text="${uid}"></option>
          </select>
          <input type="text" id="pouid" name="pouid" th:value="${poAcknowledgment?.pouid}" readonly th:if="${poAcknowledgment?.id != null}">
          <span id="pouid-error" class="error-message"></span>
      </div>
    
        <div class="form-group">      
          <label>PO Date *</label>
          <input type="date" id="podate" name="podate" readonly />
      </div>

      <div class="form-group">
        <label for="deliverydateconfirmation">Delivery Date Confirmation *</label>
        <input type="date" id="deliverydateconfirmation" name="deliverydateconfirmation" th:value="${poAcknowledgment?.deliverydateconfirmation}" required />


    </div>

    
    
       
    
      </div>
      <!-- Third Row -->
      <div class="form-row">

        <div class="form-group">
          <label for="acceptancestatus">Acceptance Status *</label>
          <select id="acceptancestatus" name="acceptancestatus" onchange="toggleReasonForRejection()" required>
        <option value="">Select Acceptance Status</option>
              <option th:selected="${poAcknowledgment?.acceptancestatus == 'Accepted'}" value="Accepted">Accepted</option>
              <option th:selected="${poAcknowledgment?.acceptancestatus == 'Rejected'}" value="Rejected">Rejected</option>
          </select>
      </div>
    

        <div class="form-group">
          <div id="reasonForRejectionSection" style="display: none;">
            <label for="reasonofrejection">Reason for Rejection *</label>
            <textarea id="reasonofrejection" style="width: 210px;" name="reasonofrejection" th:value="${poAcknowledgment?.reasonofrejection}"></textarea>
            <span id="reasonofrejection-error" class="error-message"></span>
        </div>
      </div>
      
        <div class="form-group">
          <label for="supplierrepresentativename">Supplier Representative Name *</label>
          <input type="text" id="supplierrepresentativename" name="supplierrepresentativename" th:value="${poAcknowledgment?.supplierrepresentativename}" required />
      </div>

          
      </div>

      <!-- four Row -->
      <div class="form-row">
        <div class="form-group">
          <label for="supplierrepresentativecontact">Contact number *</label>
          <input type="text" id="supplierrepresentativecontact" name="supplierrepresentativecontact"
		       maxlength="10" required th:value="${poAcknowledgment?.supplierrepresentativecontact}" />
          
        </div>
       
      
      </div>
      
      
   
    </div>

   <!-- Five Row  -->
   

 


    <div class="form-actions">
      <button type="button" id="submitBtn" onclick="validateAndSubmitForm()">Submit</button>
      <button class="back-button" th:href="@{/}">Back to Dashboard</button>
      <div id="message" th:if="${successMessage}" class="success-message" th:text="${successMessage}"></div>
     
		
		
     
    </div>
  







   </form>



   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script>
    $(document).ready(function () {
        // Allow only numbers and restrict input to 10 digits
        $('#supplierrepresentativecontact').on('input', function () {
            let phoneNumber = $(this).val().replace(/\D/g, ''); // Remove non-numeric characters

            if (phoneNumber.length > 10) {
                phoneNumber = phoneNumber.substring(0, 10); // Limit to 10 digits
            }

            $(this).val(phoneNumber);
        });

        // Validate on blur (Show alert only once)
        $('#supplierrepresentativecontact').on('blur', function () {
            let phoneNumber = $(this).val();
            if (phoneNumber.length !== 10) {
                alert('Contact number must be exactly 10 digits.');
                $(this).val(''); // Clear input if invalid
            }
        });
    });
</script>



  <script>	  
  
      function validateAndSubmitForm() {
          if (!validateForm()) {
              return; // Stop if validation fails
          }
          submitForm(); // Proceed to submit the form
      }

      function validateForm() {
          let isValid = true;

          // Validate Supplier UID
          const supplieruid = $('#supplieruid').val();
          if (!supplieruid) {
              alert("Supplier UID is required.");
              isValid = false;
              return isValid; // Stop further validation
          }

          // Validate PO UID
          const pouid = $('#pouid').val();
          if (!pouid) {
              alert("PO UID is required.");
              isValid = false;
              return isValid; // Stop further validation
          }

          // Validate Delivery Date Confirmation
          const deliverydateconfirmation = $('#deliverydateconfirmation').val();
          if (!deliverydateconfirmation) {
              alert("Delivery Date Confirmation is required.");
              isValid = false;
              return isValid; // Stop further validation
          }

          // Validate Acceptance Status
          const acceptancestatus = $('#acceptancestatus').val();
          if (!acceptancestatus) {
              alert("Acceptance Status is required.");
              isValid = false;
              return isValid; // Stop further validation
          }

          // Validate Reason for Rejection (if status is Rejected)
          if (acceptancestatus === "Rejected") {
              const reasonofrejection = $('#reasonofrejection').val();
              if (!reasonofrejection) {
                  alert("Reason for Rejection is required when status is Rejected.");
                  isValid = false;
                  return isValid; // Stop further validation
              }
          }

          // Validate Supplier Representative Name
          const supplierrepresentativename = $('#supplierrepresentativename').val();
          if (!supplierrepresentativename) {
              alert("Supplier Representative Name is required.");
              isValid = false;
              return isValid; // Stop further validation
          }

          // Validate Supplier Representative Contact
          const supplierrepresentativecontact = $('#supplierrepresentativecontact').val();
          if (!supplierrepresentativecontact) {
              alert("Supplier Representative Contact is required.");
              isValid = false;
              return isValid; // Stop further validation
          }

          return isValid;
      }

      function toggleReasonForRejection() {
          const acceptancestatus = $('#acceptancestatus').val();
          if (acceptancestatus === "Rejected") {
              $('#reasonForRejectionSection').show();
          } else {
              $('#reasonForRejectionSection').hide();
          }
      }

      function submitForm() {
          const formData = new FormData(document.getElementById('POAcknowledgmentForm'));
          const id = $('#id').val();

          let url, successMessage;

          if (!id) {
              url = '/poacknowledgmentform/save';
              successMessage = 'PO Acknowledgment saved successfully!';
          } else {
              url = '/poacknowledgment/update';
              successMessage = 'PO Acknowledgment updated successfully!';
          }

          $.ajax({
              url: url,
              type: 'POST',
              data: formData,
              processData: false,
              contentType: false,
              success: function(response) {
                  $('#message').text(successMessage);
                  resetForm();
                  window.location.href = '/poacknowledgment/List';
              },
              error: function() {
                  alert('Error saving PO Acknowledgment. Please fill out all required fields.');
              }
          });
      }

      function resetForm() {
          $('#POAcknowledgmentForm')[0].reset();
          $('#id').val('');
          $('#message').text('');
          $('#form-title').text('Add New PO Acknowledgment');
          $('#submitBtn').text('Submit');
          $('#reasonForRejectionSection').hide(); // Hide reason for rejection section on reset
      }

  $(document).ready(function() {
        // Auto-fill Item details when updating
        var existingSupplierid = $('#supplieruid').val();
        if (existingSupplierid) {
          fetchSupplierDetails(existingSupplierid);
        }
    });

      function fetchSupplierDetails(supplieruid) {
          if (!supplieruid) return;

          $.ajax({
              url: '/getSupplierdetails',
              method: 'GET',
              data: { supplieruid: supplieruid },
              success: function(response) {
                  if (response && response.length > 0) {
                      let Data = response[0];
                      $('#suppliername').val(Data.suppliername || '');
                  } else {
                      alert('No data found for the selected supplier.');
                  }
              },
              error: function(xhr, status, error) {
                  console.error('Error fetching supplier details:', error);
                  alert('Error fetching supplier details. Please try again.');
              }
          });
      }

      function fetchPoDetails(pouid) {
          if (!pouid) return;

          $.ajax({
              url: '/getpodetails',
              method: 'GET',
              data: { pouid: pouid },
              success: function(response) {
                  if (response && response.length > 0) {
                      const Data = response[0];
                      $('#podate').val(Data.podate || '');
                  } else {
                      alert('No data found for the selected PO.');
                  }
              },
              error: function(xhr, status, error) {
                  console.error('Error fetching PO details:', error);
                  alert('Error fetching PO details. Please try again.');
              }
          });
      }

      // Initialize the form
      $(document).ready(function() {
          toggleReasonForRejection(); // Set initial visibility of reason for rejection section
      });
  </script>
<script>
$(document).ready(function () {
    // Validate Supplier Representative Contact on input
    $('#supplierrepresentativecontact').on('input', function () {
        let contact = $(this).val().replace(/\D/g, ''); // Remove non-numeric characters
        if (contact.length >= 10){
            alert('Phone number cannot exceed 10 digits.');
            contact = contact.slice(0, 10); // Trim extra digits
        }
        $(this).val(contact);
    });

    function validateForm() {	
        let isValid = true;

        // Validate Supplier Representative Contact
        const supplierContact = $('#supplierrepresentativecontact').val().trim();
        const phoneRegex = /^[0-9]{10}$/; // Regular expression for 10-digit number

        if (!supplierContact) {
            alert('Supplier Representative Contact is required.');
            $('#supplierrepresentativecontact').focus();
            isValid = false;
            return isValid;
        } else if (!phoneRegex.test(supplierContact)) {
            alert('Supplier Representative Contact must be a valid 10-digit phone number.');
            $('#supplierrepresentativecontact').focus();
            isValid = false;
            return isValid;
        }

        return isValid; // Proceed if all validations pass
    }

    function validateAndSubmitForm() {
        if (!validateForm()) {
            return; // Stop if validation fails
        }
        submitForm(); // Proceed to submit the form
    }

   
       
});

</script>

</body>
</html>
