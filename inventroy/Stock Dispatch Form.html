<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Dispatch Form</title>
  <link rel="stylesheet" href="hrms.css">
  <link rel="stylesheet" href="sty.css">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
</head>
<style>
h5{
  margin: 10px;
}
</style>
<body>
                    
  </div>

   <div class="form-container" style="max-width: 877px;" >
    <!-- Personal Information Section -->
    <input type="hidden" id="id" name="id" th:value="${dispatch?.id}">
    <div class="form-section active" id="section1">
      <input type="hidden" name="id" th:value="${warehouse?.id}" />
      <h2>Stock Transfer Form</h2>

      <!-- First Row -->
      <h5>General Information</h5>
      <div class="form-row">
        
        <div class="form-group">        
          <label for="dispatchtype">Dispatch Type:</label>
          <select id="dispatchtype" name="dispatchtype" th:value="${dispatch?.dispatchtype}" required>
              <option value="">Select Dispatch Type</option>
              <option value="Customer Order" th:selected="${dispatch?.dispatchtype == 'Customer Order'}">Customer Order</option>
              <option value="Transfer" th:selected="${dispatch?.dispatchtype == 'Transfer'}">Transfer</option>
              <option value="Return" th:selected="${dispatch?.dispatchtype == 'Return'}">Return</option>
          </select>
        </div>     
     

        
      </div>

      <!-- Second Row -->
      <h5>Customer/Recipient Details</h5>      
      <div class="form-row">
        <div class="form-group">
          <label for="customerid">Customer ID:</label>
          <select id="customerid" name="customerid" onchange="fetchCustomerDetails(this.value)" required th:if="${dispatch == null or dispatch.id == null}">
            <option value=""> Select Customer Details</option>
            <option th:each="uid : ${customerid}" th:value="${uid}" th:text="${uid}" ></option>					
          </select>	
	      </div>
   
        <div class="form-group">
          <br>
          <input type="text" id="customerid" name="customerid" th:value="${dispatch?.customerid}" onchange="fetchCustomerDetails(this.value)" readonly th:if="${dispatch?.id != null}">
        </div>

        <div class="form-group">
          <label for="deliveryaddress">Delivery Address:</label>
	            <input type="text" id="deliveryaddress" name="deliveryaddress" rows="2">
        </div>
        <div class="form-group" >
          <label for="contactperson">Contact Person:</label>
	            <input type="text" id="contactperson" name="contactperson">
        </div>
        <div class="form-group">
          <label for="contactnumber">Contact Number:</label>
          <input type="tel" id="contactnumber" name="contactnumber">
        </div>
      </div>
      <!-- Third Row -->
      <h5>Item Details</h5>
      <div class="form-row">
      
          <div class="form-group">            
            <label for="itemid">Item ID:</label>
            <select id="itemid" name="itemid"  onchange="fetchItemDetails(this.value)" th:if="${dispatch == null or dispatch.id == null}" required>
              <option value=""> Select Item Details:</option>
              <option th:each="uid : ${itemid}" th:value="${uid}" th:text="${uid}" ></option>					
            </select>
          </div>

          <div class="form-group">
            <br>
            <input type="text" id="itemid" name="itemid" th:value="${dispatch?.itemid}" onchange="fetchItemDetails(this.value)" readonly th:if="${dispatch?.id != null}">   
        </div>
        <div class="form-group">
          <label for="unitofmeasure">Unit of Measure (UOM):</label>
          <input type="text" id="unitofmeasure" name="unitofmeasure">
        </div>
        <div class="form-group">
          <label for="batchnumber">Batch/Lot Number:</label>
          <input type="text" id="batchnumber" name="batchnumber">       
        </div>
       
      </div>

      <!-- four Row -->

      <h5>Dispatch Information</h5>
      <div class="form-row">
        <div class="form-group">
        <label for="carriername">Carrier Name: </label>
				<select id="carriername" name="carriername" onchange="fetchDispatchInformation(this.value)" th:value="${stockdispatch?.approvedby}" th:if="${dispatch == null or dispatch.id == null}" required>
						<option value=""> Select Carrier Name: </option>
						<option th:each="uid : ${carriername}" th:value="${uid}" th:text="${uid}" ></option>					
				</select>
        </div> 

        <div class="form-group">
          <br>
          <input type="text" id="carriername" name="carriername" th:value="${dispatch?.carriername}" onchange="fetchDispatchInformation(this.value)" readonly th:if="${dispatch?.id != null}">
        </div>     
        <div class="form-group">
          <label for="transportdocumentnumber" style="font-size: 12px;">Transport Document Number:</label>
	            <input type="text" id="transportdocumentnumber" name="transportdocumentnumber" > 
        </div>   
        <div class="form-group">
          <label for="modeoftransport">Mode of Transport:</label>
				<input type="text" id="modeoftransport" name="modeoftransport" >
        </div>
        <div class="form-group">
          <label for="dispatchcost">Dispatch Cost: </label>
	            <input type="number" id="dispatchcost" name="dispatchcost" step="0.01">
        </div>
      </div>

   <!-- Five Row  -->
   <h5>Approval and Authorization</h5>
   <div class="form-row">
     <div class="form-group">
      <label for="dispatchedby">Dispatched By: </label>
	            <input type="text" id="dispatchedby" name="dispatchedby"  th:value="${dispatch?.dispatchedby}" required>
     </div>

     <div class="form-group">
      <label for="approvedby">Approved By:</label>
      <select id="approvedby" name="approvedby" th:value="${dispatch?.approvedby}" required>
          <option value="">Select Approver</option>
          <option value="Manager" th:selected="${dispatch?.approvedby == 'Manager'}">Manager</option>
          <option value="HR" th:selected="${dispatch?.approvedby == 'HR'}">HR</option>
      </select>
     </div>  

     <div class="form-group">
      <label for="approvaldate">Approval Date:</label>
      <input type="date" id="approvaldate" name="approvaldate" th:value="${dispatch?.approvaldate}" required>
     </div>
   </div>  

   <h5>Additional Details</h5>
   <div class="form-row">
     <div class="form-group">
      <label for="status">Status: </label>
	            <select id="status" name="status" th:value="${dispatch?.status}" required>
	                <option value="">Select Status</option>
	                <option value="Pending" th:selected="${dispatch?.status == 'Pending'}">Pending</option>
	                <option value="In Transit" th:selected="${dispatch?.status == 'In Transit'}">In Transit</option>
	                <option value="Delivered" th:selected="${dispatch?.status == 'Delivered'}">Delivered</option>
	            </select>
     </div>
     <div class="form-group">
      <label for="remarks">Remarks</label>
      <input type="text" id="remarks" name="remarks" rows="3" th:text="${dispatch?.remarks}"></input>
     </div>
   </div> 


      <div class="form-actions">
        <button type="button" id="submitBtn" onclick="submitForm()">Submit</button>	
        <button>
          <a class="back-button" th:href="@{/}">Back to Dashboard</a>
        </button>	
        <div th:if="${successMessage}" class="success-message" th:text="${successMessage}"></div>      
      </div>
  </div>






   </div>






  

   <script>
    $(document).ready(function() {
         // Auto-fill Item details when updating
         var existingCustomerUid = $('#customerid').val();
         if (existingCustomerUid) {
           fetchCustomerDetails(existingCustomerUid);
         }
     });
    
   function fetchCustomerDetails(customerid) {
    if (!customerid) 		return; 
 
       $.ajax({
       url: '/customerdetails',
       method: 'GET',
       data: { customerid: customerid },
       success: function(response) {
         $('#contactnumber').val(response.contactNumber);
         $('#contactperson').val(response.contactperson);
         $('#deliveryaddress').val(response.deliveryAddress);	
       
     }		,
           error:function() {
                alert('Error fetching customer details. Please try again.');
            }
       });
   }
   </script>
   <script>
    $(document).ready(function() {
         // Auto-fill Item details when updating
         var existingItemid = $('#itemid').val();
         if (existingItemid) {
           fetchItemDetails(existingItemid);
         }
     });
    
   function fetchItemDetails(itemid) {
       if (!itemid) return;
 
       $.ajax({
           url: '/item/details', // Endpoint to fetch data
           method: 'GET', // HTTP method
           data: { itemid: itemid }, // Query parameter to be sent to the server
           success: function(response) {
               // Populate response data into form fields
               $('#batchnumber').val(response.batchNumber);
               $('#unitofmeasure').val(response.unitOfMeasure);
           },
       error:function(){
         alert('Error occur');
       }
       });
   }
   </script>
   <script>
    $(document).ready(function() {
         // Auto-fill Item details when updating
         var existingDispatchUid = $('#carriername').val();
         if (existingDispatchUid) {
           fetchDispatchInformation(existingDispatchUid);
         }
     });
   //Fetch Dispatch Information data from Dispatch Information database
     function fetchDispatchInformation(carriername) {
      if (!carriername) return; 
 
         $.ajax({
         url: '/dispatchinformation',
         method: 'GET',
         data: { carriername: carriername },
         success: function(response) {
           $('#transportdocumentnumber').val(response.transportDocumentNumber);	
           $('#modeoftransport').val(response.modeOfTransport);
           $('#dispatchcost').val(response.dispatchost);	
         
       },
       error:function() {
            alert('Error fetching Dispatch Information. Please try again.');
                           }
                   });
     }
     
     function submitForm() {
 let form = document.getElementById('stockdispatchForm');
         
         if (!form.checkValidity()) {
             alert('Please fill in all required fields.');
             return;
         }
 
             const formData = new FormData(document.getElementById('stockdispatchForm'));
             const id = $('#id').val();
 
             let url, successMessage;
 
             if (!id) {
                 url = '/addstockdispatch';
                 successMessage = 'Stock Dispatch Details saved successfully!';
             } else {
                 url = '/updateExistingStock';
                 successMessage = 'Stock Dispatch Details updated successfully!';
             }
 
             $.ajax({
                 url: url,
                 type: 'POST',
                 data: formData,
                 processData: false,
                 contentType: false,
                 success: function(response) {
                     $('#message').text(successMessage); // Display success message
                     resetForm();
                     window.location.href = '/viewstockdispatchlist';
                 },
                 error: function() {
                     alert('Error saving Stock Dispatch. Please fill out the data.');
                 }
             });
         }
         // Reset the form
             function resetForm() {
                 $('#stockdispatchForm')[0].reset();
               $('#id').val('');
                 $('#message').text(''); // Clear the message
                 $('#submitBtn').text('Submit');
             }
             
             function prefillForm(data) {
                     $('#id').val(data.id);
                     $('#dispatchtype').val(data.dispatchtype);
                     $('#customerid').val(data.customerid);
                     $('#itemid').val(data.itemid);
                     $('#carriername').val(data.carriername);
                     $('#dispatchedby').val(data.dispatchedby);
                     $('#approvedby').val(data.approvedby);
                     $('#approvaldate').val(data.approvaldate);
                     $('#status').val(data.status);
                     $('#remarks').val(data.remarks);
                 $('#form-title').text('Update Stock Dispatch Form');
                 $('#submitBtn').text('Update');
             }
             document.getElementById('submitBtn').addEventListener('click', function () {
                 let requiredFields = document.querySelectorAll('#stockdispatchForm [required]');
                 let isValid = true;
 
                 requiredFields.forEach(field => {
                     if (!field.value.trim()) {
                         field.style.border = '2px solid red';
                         isValid = false;
                     } else {
                         field.style.border = '1px solid #ccc';
                     }
                 });
 
                 if (isValid) {
                     submitForm();
                 } else {
                     alert('Please fill in all required fields.');
                 }
             });
     </script>


</body>
</html>
