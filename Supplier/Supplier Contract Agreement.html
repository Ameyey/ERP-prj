<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supplier Contract Agreement</title>
  <link rel="stylesheet" href="hrms.css"> <!-- // for side bar code  -->
  <link rel="stylesheet" href="sty.css">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <style>
    .form-group textarea {
    width: 230px;
    height: 50px;
  }
  </style>
<body onload="fetchItemDetail()">

  <form id="supplierContractForm" onsubmit="validateForm(event)">
    <div class="form-container">
      <input type="hidden" id="id" name="id" th:value="${supplierContract?.id}">      
      <div class="form-section active">
        <h2>Supplier Contract Agreement Form</h2>
        
        <!-- First Row -->
        <div class="form-row">
          <div class="form-group">
            <label for="supplieruid">supplieruid :</label>
            <select id="supplieruid" name="supplieruid" onchange="fetchItemDetail()" required th:if="${supplierContract == null or supplierContract.id == null}">
                <option value="">--Select Item ID--</option>
                <option th:each="uid : ${supplieruid}"
                        th:value="${uid}"
                        th:text="${uid}"></option>
            </select>    
            <input type="text" id="supplieruid" name="supplieruid" th:value="${supplierContract?.supplieruid}" th:if="${supplierContract?.id != null}">
          </div>
          <div class="form-group">
            <label>supplier Name:</label>
            <input type="text" id="toitemname" name="toitemname" readonly />
          </div>
          <div class="form-group">
            <label for="contractstartdate">Contract Start Date:</label>
            <input type="date" id="contractstartdate" name="contractstartdate" th:value="${supplierContract?.contractstartdate}" required>
          </div>
          <div class="form-group">
            <label for="contractenddate">Contract End Date:</label>
            <input type="date" id="contractenddate" name="contractenddate" th:value="${supplierContract?.contractenddate}" required>
           </div>
        
        </div>
        <!-- Second Row -->
        <div class="form-row">          
          <div class="form-group">
            <label for="scopeofsupply">Scope of Supply:</label>
        <textarea id="scopeofsupply" name="scopeofsupply" required placeholder="Enter scope of supply" th:text="${supplierContract?.scopeofsupply}"></textarea>
        </div>
        <div class="form-group">          
            <label for="pricingagreement">Pricing Agreement:</label>
            <textarea id="pricingagreement" name="pricingagreement" required placeholder="Enter pricing agreement" th:text="${supplierContract?.pricingagreement}"></textarea>
        </div>
        <div class="form-group">
          <label for="qualitycompliancestandards">Quality Compliance Standards:</label>
          <textarea id="qualitycompliancestandards" name="qualitycompliancestandards" required placeholder="Enter quality compliance standards" th:text="${supplierContract?.qualitycompliancestandards}"></textarea>
      </div>
       
        </div>

        <!-- Third Row -->
        <div class="form-row">          
        <div class="form-group">
          <label for="paymentterms">Payment Terms:</label>
        <textarea id="paymentterms" name="paymentterms" required placeholder="Enter payment terms" th:text="${supplierContract?.paymentterms}"></textarea>
        </div>
          <div class="form-group">
            <label for="terminationclause">Termination Clause:</label>
            <textarea id="terminationclause" name="terminationclause" required placeholder="Enter termination clause" th:text="${supplierContract?.terminationclause}"></textarea>
          </div>
          <div class="form-group">
            <label for="renewalterms">Renewal Terms:</label>
        <textarea id="renewalterms" name="renewalterms" required placeholder="Enter renewal terms" th:text="${supplierContract?.renewalterms}"></textarea>
          </div> 
         
        </div>
      <br>
        <!-- Other Fields -->
        <div class="form-row">
                  
          <div class="form-group">
            <label for="supplierrepresentativename">Supplier Representative Name:</label>
        <input type="text" id="supplierrepresentativename" name="supplierrepresentativename" th:value="${supplierContract?.supplierrepresentativename}" required>
          </div>
          <div class="form-group">
            <label for="companyrepresentativename">Company Representative Name:</label>
        <input type="text" id="companyrepresentativename" name="companyrepresentativename" th:value="${supplierContract?.companyrepresentativename}" required>
          </div>
          <div class="form-group">
            <label for="dateofapproval">Date of Approval:</label>           
            <input type="date" id="dateofapproval" name="dateofapproval" th:value="${supplierContract?.dateofapproval}" required>
          </div>          
          
          
        
      </div>
      <div class="form-actions">
        <button type="button" id="submitBtn" onclick="submitForm()">Submit</button>
      <div th:if="${successMessage}" class="success-message" th:text="${successMessage}"></div>
      </div>
    </div>
  </form>

  
</body>
<script>
		
		
  document.addEventListener("DOMContentLoaded", function() {
            // Set Contract Start Date to today or future
            let today = new Date().toISOString().split("T")[0];
            document.getElementById("contractstartdate").setAttribute("min", today);
            
            document.getElementById("contractstartdate").addEventListener("change", validateDates);
            document.getElementById("contractenddate").addEventListener("change", validateDates);
        });

        function validateDates() {
            let startDate = document.getElementById("contractstartdate").value;
            let endDate = document.getElementById("contractenddate").value;

            if (startDate) {
                document.getElementById("contractenddate").setAttribute("min", startDate);
            }

            if (endDate && endDate <= startDate) {
                alert("Contract End Date must be greater than Contract Start Date.");
                document.getElementById("contractenddate").value = "";
            }
        }

        function validateForm(event) {
            let startDate = document.getElementById("contractstartdate").value;
            let endDate = document.getElementById("contractenddate").value;

            if (!startDate || !endDate) {
                alert("Please select both Contract Start Date and Contract End Date.");
                event.preventDefault();
                return false;
            }

            if (endDate <= startDate) {
                alert("Contract End Date must be greater than Contract Start Date.");
                event.preventDefault();
                return false;
            }

            return true;
        }
      
      
  function validateForm() {
            const textFields = [
                "scopeofsupply", "pricingagreement", "qualitycompliancestandards", "paymentterms", 
                "terminationclause", "renewalterms", "supplierrepresentativename", "companyrepresentativename"
            ];

            const regex = /^[A-Za-z\s]+$/;
            let isValid = true;

            textFields.forEach(field => {
                let inputField = document.getElementById(field);
                if (!regex.test(inputField.value.trim())) {
                    alert(`Invalid input in ${field.replace(/([A-Z])/g, ' $1')}. Only letters and spaces are allowed.`);
                    isValid = false;
                }
            });

            return isValid;
        }
      
      
      
      function submitForm() {
    if (!validateForm()) {
                   return; // Stop submission if validation fails
               }
    
          const form = document.getElementById('supplierContractForm');
          const formData = new FormData(form);
          const id = $('#id').val();

          const url = id ? '/SupplierContract/update' : '/SupplierContract/save';
          const successMessage = id ? 'Supplier Contract updated successfully!' : 'Supplier Contract saved successfully!';

          $.ajax({
              url: url,
              type: 'POST',
              data: formData,
              processData: false,
              contentType: false,
              success: function () {
                  alert(successMessage);
                  form.reset();
                  setTimeout(() => window.location.href = '/SupplierContract/List', 1500);
              },
              error: function (xhr) {
                  alert('Error saving supplier contract record. Please try again.');
                  console.error(xhr.responseText);
              }
          });
      }

  
     function resetForm() {
              $('#supplierContractForm')[0].reset();
              $('#id').val('');
              $('#form-title').text('supplierContractForm');
              $('#submitBtn').text('Submit');
          }

          function prefillForm(data) {
              $('#id').val(data.id);
              $('#contractstartdate').val(data.contractstartdate);
              $('#contractenddate').val(data.contractenddate);
              $('#scopeofsupply').val(data.scopeofsupply);
              $('#pricingagreement').val(data.pricingagreement);
              $('#qualitycompliancestandards').val(data.qualitycompliancestandards);
              $('#paymentterms').val(data.paymentterms);
              $('#terminationclause').val(data.terminationclause);
        $('#renewalterms').val(data.renewalterms);
        $('#supplierrepresentativename').val(data.supplierrepresentativename);					
        $('#companyrepresentativename').val(data.companyrepresentativename);
        $('#correctiveaction').val(data.correctiveaction);
        $('#dateofapproval').val(data.dateofapproval);

           if (data.id) {
                        // If updating, replace dropdown with readonly input
                        $('#supplieruid').replaceWith('<input type="text" id="supplieruid" name="productuid" value="' + data.supplieruid + '" readonly>'); 
  }

              $('#form-title').text('Update supplier contract');
              $('#submitBtn').text('Update');
          }
      
      
      function fetchItemDetail() {
          const supplieruid = $('#supplieruid').val();

          if (!supplieruid) {
              return;
          }

          $.ajax({
              url: '/getsupplieruidinfo',
              method: 'GET',
              data: { supplieruid: supplieruid },
              success: function (response) {
                  console.log("Response from server:", response);
                  if (response && response.length > 0) {
                      const ItemDetail = response[0];
                      $('#toitemname').val(ItemDetail.suppliername || '');
                  } else {
                      alert("No details found for the selected Supplier UID.");
                  }
              },
              error: function (xhr, status, error) {
                  console.error("Error fetching Item details:", error);
                  alert("An error occurred while fetching the Item details.");
              }
          });
      }
  </script>
</html>
