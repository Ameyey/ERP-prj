<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finished Goods Quality Control Form</title>
  <link rel="stylesheet" href="hrms.css">
  <link rel="stylesheet" href="sty.css">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
</head>
<style>
  .form-row{
    display: flex;
    gap: 25px;
    margin-bottom: 21px;
  }
  h2{
    font-size: 21px;
    margin-bottom: 44px;
  }
</style>
<body onload="fetchProductDetails(this.value)"> 

   <form id="FinishedGoodsQCForm" class="form-container"  style="padding: 20px 68px;" >
    <!-- Personal Information Section -->
    <input type="hidden" id="id" name="id" th:value="${finishedGoodsQC?.id}">
    <div class="form-section active" id="section1">
      <h2>Finished Goods Quality Control Form</h2>

      <!-- First Row -->
    
      <div class="form-row">
        
        <div class="form-group">        
          <label for="inspectionuid">Inspection ID</label>
          <input type="text" id="inspectionuid" name="inspectionuid" th:value="${finishedGoodsQC?.id}" readonly />
          <span id="inspectionuid-error" class="error-message"></span>  
        </div>

        <div class="form-group">
          <label for="batchuid">Batch UID</label>
          <select id="batchuid" name="batchuid" onchange="fetchproductDetails(this.value)" th:if="${finishedGoodsQC == null or finishedGoodsQC.id == null}" required>
              <option value="">--Select Batch ID--</option>
              <option th:each="batchuid : ${batchuids}" th:value="${batchuid}" th:text="${batchuid}"></option>
          </select>
        </div>

        <div class="form-group">
          <br>
          <input type="text" id="batchuid" name="batchuid" th:value="${finishedGoodsQC?.batchuid}" readonly th:if="${finishedGoodsQC?.id != null}">
          <span id="batchuid-error" class="error-message"></span>  
        </div>

        

      </div>

      <!-- Second Row -->
      <div class="form-row">
        <div class="form-group">
          <label for="productuid">Product UID</label>
        <input type="text" id="productuid" name="productuid" th:value="${finishedGoodsQC?.productuid}" required />
        <span id="productuid-error" class="error-message"></span>
      </div>
        <div class="form-group">
          <label for="productName">Product Name *</label>
          <input type="text" id="productname" name="productname" required />
          <span id="productname-error" class="error-message"></span>
	      </div>
   
        <div class="form-group">
          <label for="inspectiondate">Inspection Date *</label>
        <input type="date" id="inspectiondate" name="inspectiondate" th:value="${finishedGoodsQC?.inspectiondate}" required />
        <span id="inspectiondate-error" class="error-message"></span>
        </div>

       
      </div>
      <!-- Third Row -->
      <div class="form-row">
        <div class="form-group">
          <label for="dimensionsandweight">Dimensions & Weight *</label>
          <input type="text" id="dimensionsandweight" name="dimensionsandweight" th:value="${finishedGoodsQC?.dimensionsandweight}" required />
          <span id="dimensionsandweight-error" class="error-message"></span>  
        </div>

        <div class="form-group" >         
          <label for="packagingcondition">Packaging Condition *</label>
          <select id="packagingcondition" name="packagingcondition" th:value="${finishedGoodsQC?.packagingcondition}" required>
              <option th:selected="${finishedGoodsQC?.packagingcondition == 'Pass'}" value="Pass">Pass</option>
              <option th:selected="${finishedGoodsQC?.packagingcondition == 'Fail'}" value="Fail">Fail</option>
          </select>
          <span id="packagingcondition-error" class="error-message"></span>
        </div>
      
          <div class="form-group">            
            <label for="functionalitytest">Functionality Test *</label>
            <select id="functionalitytest" name="functionalitytest" th:value="${finishedGoodsQC?.functionalitytest}" required>
                <option th:selected="${finishedGoodsQC?.functionalitytest == 'Pass'}" value="Pass">Pass</option>
                <option th:selected="${finishedGoodsQC?.functionalitytest == 'Fail'}" value="Fail">Fail</option>
            </select>
            <span id="functionalitytest-error" class="error-message"></span>
          </div>
      </div>

      <div class="form-row">
        <div class="form-group">
            <label for="visualinspection">Visual Inspection *</label>
            <select id="visualinspection" name="visualinspection" th:value="${finishedGoodsQC?.functionalitytest}" required>
                <option th:selected="${finishedGoodsQC?.visualinspection == 'Pass'}" value="Pass">Pass</option>
                <option th:selected="${finishedGoodsQC?.visualinspection == 'Fail'}" value="Fail">Fail</option>
            </select>
            <span id="visualinspection-error" class="error-message"></span>
         </div>

        <div class="form-group">
          <label for="samplesize">Sample Size *</label>
          <input type="number" id="samplesize" name="samplesize" min="0" th:value="${finishedGoodsQC?.samplesize}" required />
         <span id="samplesize-error" class="error-message"></span>
        </div>

        <div class="form-group">
          <label for="defectiveitemscount">Defective Items Count*</label>
          <input type="number" id="defectiveitemscount" name="defectiveitemscount" min="0" th:value="${finishedGoodsQC?.defectiveitemscount}" required />
        <span id="defectiveitemscount-error" class="error-message"></span>              
        </div>
      </div>

      <!-- four Row -->

      <div class="form-row">
        <div class="form-group">
          <label for="defectrate">Defect Rate (%) *</label>
          <input type="text" id="defectrate" name="defectrate" min="0" th:value="${finishedGoodsQC?.defectrate}" required />
          <span id="defectrate-error" class="error-message"></span>
        </div>

        <div class="form-group">
         <label for="finalapprovalstatus">Final Approval Status *</label>
        <select id="finalapprovalstatus" name="finalapprovalstatus" th:value="${finishedGoodsQC?.finalapprovalstatus}" required>
            <option th:selected="${finishedGoodsQC?.finalapprovalstatus == 'Approved'}" value="Approved">Approved</option>
            <option th:selected="${finishedGoodsQC?.finalapprovalstatus == 'Rework'}" value="Rework">Rework</option>
            <option th:selected="${finishedGoodsQC?.finalapprovalstatus == 'Rejected'}" value="Rejected">Rejected</option>
        </select>
        <span id="finalapprovalstatus-error" class="error-message"></span> 	
        </div> 

        <div class="form-group">
          <label for="actiontaken">Action Taken *</label>
        <select id="actiontaken" name="actiontaken" th:value="${finishedGoodsQC?.actiontaken}" required>
            <option th:selected="${finishedGoodsQC?.actiontaken == 'Send to Warehouse'}" value="Send to Warehouse">Send to Warehouse</option>
            <option th:selected="${finishedGoodsQC?.actiontaken == 'Rework'}" value="Rework">Rework</option>
            <option th:selected="${finishedGoodsQC?.actiontaken == 'Scrap'}" value="Scrap">Scrap</option>
        </select>
        <span id="actiontaken-error" class="error-message"></span>
     </div>
         
      
      
        
    </div>

   <!-- Five Row  -->
 

 


    <div class="form-actions">
      <button type="button" id="submitBtn" onclick="submitForm()">Submit</button>
      <div th:if="${successMessage}" class="success-message" th:text="${successMessage}"></div>                  
    </div>
  







   </form>



   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script>
    // New function for popup validation
    function validateFormWithPopup() {
        // Validate Batch UID
        const batchuid = $('#batchuid').val();
        if (!batchuid) {
            alert('Batch UID is required.');
            $('#batchuid').focus();
            return false;
        }

        // Validate Product UID
        const productuid = $('#productuid').val();
        if (!productuid) {
            alert('Product UID is required.');
            $('#productuid').focus();
            return false;
        }

        // Validate Product Name
        const productname = $('#productname').val();
        if (!productname) {
            alert('Product Name is required.');
            $('#productname').focus();
            return false;
        }

        // Validate Inspection Date
        const inspectiondate = $('#inspectiondate').val();
        if (!inspectiondate) {
            alert('Inspection Date is required.');
            $('#inspectiondate').focus();
            return false;
        }

        // Validate Dimensions & Weight
        const dimensionsandweight = $('#dimensionsandweight').val();
        if (!dimensionsandweight) {
            alert('Dimensions & Weight is required.');
            $('#dimensionsandweight').focus();
            return false;
        }

        // Validate Sample Size
        const samplesize = $('#samplesize').val();
        if (!samplesize || isNaN(samplesize)) {
            alert('Sample Size must be a valid number.');
            $('#samplesize').focus();
            return false;
        }

        // Validate Defective Items Count
        const defectiveitemscount = $('#defectiveitemscount').val();
        if (!defectiveitemscount || isNaN(defectiveitemscount)) {
            alert('Defective Items Count must be a valid number.');
            $('#defectiveitemscount').focus();
            return false;
        }

        // Validate Defect Rate
        const defectrate = $('#defectrate').val();
        if (!defectrate || isNaN(defectrate)) {
            alert('Defect Rate must be a valid number.');
            $('#defectrate').focus();
            return false;
        }

        // If all validations pass
        return true;
    }

    // Modify the submitForm function to use the new validation function
    function submitForm() {
        // Call the popup validation function
        if (!validateFormWithPopup()) {
            return; // Stop submission if validation fails
        }

        const formData = new FormData(document.getElementById('FinishedGoodsQCForm'));
        const id = $('#id').val();

        let url, successMessage;

        if (!id) {
            url = '/finishqc-form';
            successMessage = 'Quality Control saved successfully!';
        } else {
            url = '/finishqc/update';
            successMessage = 'Quality Control updated successfully!';
        }

        $.ajax({
            url: url,
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                $('#message').text(successMessage);
                resetForm();
                window.location.href = '/finishqcList';
            },
            error: function() {
                alert('Error saving Quality Control. Please fill out all required fields.');
            }
        });
    }

    // Rest of your existing code remains unchanged
    function resetForm() {
        $('#FinishedGoodsQCForm')[0].reset();
        $('#id').val('');
        $('#message').text('');
        $('#form-title').text('Add New Quality Control');
        $('#submitBtn').text('Submit');
    }

    function fetchproductDetails(batchuid) {
        if (!batchuid) return;

        $.ajax({
            url: '/getDataByBatchuid',
            method: 'GET',
            data: { batchuid: batchuid },
            success: function(response) {
                if (response && response.length > 0) {
                    let stockData = response[0];
                    $('#productuid').val(stockData.productuid || '');
                    $('#productname').val(stockData.productname || '');
                } else {
                    alert('No data found for the selected product.');
                }
            },
            error: function(xhr, status, error) {
                console.error('Error fetching product details:', error);
                alert('Error fetching product details. Please try again.');
            }
        });
    }
</script>
  





  


</body>
</html>
