
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supplier Performance Evaluation</title>
  <link rel="stylesheet" href="hrms.css">
  <link rel="stylesheet" href="sty.css">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
</head>
<style>

</style>
<body>

   <form id="supplierForm" class="form-container"  >
    <!-- Personal Information Section -->
    <input type="hidden" id="id" name="id" th:value="${supplier?.id}" >

    <div class="form-section active" id="section1">
      <h2>Supplier Performance Evaluation</h2>

      <!-- First Row -->
    
      <div class="form-row">
        
        <div class="form-group">        
          <label>Supplier UID:</label>
          <select id="supplieruid" name="supplieruid" onchange="fetchSupplierDetails(this.value)" th:if="${supplier == null or supplier.id == null}">
              <option value="">Select Supplier UID</option>
              <option th:each="uid : ${supplieruid}" th:value="${uid}" th:text="${uid}"></option>
          </select>
        </div>

        <div class="form-group">
          <br>
          <input type="text" id="supplieruid" name="supplieruid" th:value="${supplier?.supplieruid}" onchange="fetchSupplierDetails(this.value)" readonly th:if="${supplier?.id != null}">
        </div>

        <div class="form-group">
          <label>Supplier Name:</label>
          <input type="text" id="suppliername" name="suppliername" readonly> 
        </div>       
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Evaluation Period:</label>
          <input type="month" id="evaluationperiod" name="evaluationperiod" th:value="${supplier?.evaluationperiod}" required>
        </div>

        <div class="form-group">
			<label>On-Time Delivery Rate (%):</label>
			<input type="number" id="ontimedeliveryrate" name="ontimedeliveryrate" th:value="${supplier?.ontimedeliveryrate}" min="0" max="100" step="0.01" required >
        </div>

        <div class="form-group">
          <label>Quality Rating:</label>
          <input type="number" id="qualityrating" name="qualityrating" min="1" max="10" th:value="${supplier?.qualityrating}" required> 
        </div>
      </div>

      <br>
      <br>
      <!-- Second Row -->
      <div class="form-row" >
        <div class="form-group" >
          <label>Order Accuracy (%):</label>
          <input type="number" id="orderaccuracy" name="orderaccuracy" 
                 th:value="${supplier?.orderaccuracy}" min="0" max="100" step="0.01" required >         
	      </div>
   
        <div class="form-group">
          <label>Responsiveness Score:</label>
          <input type="number" id="responsivenessscore" name="responsivenessscore" min="1" max="10" th:value="${supplier?.responsivenessscore}" required >
        </div>

        <div class="form-group">
          <label>Compliance Score:</label>
          <input type="number" id="compliancescore" name="compliancescore" min="1" max="10" th:value="${supplier?.compliancescore}" required >
        </div>

        
      </div>
      <!-- Third Row -->

      <div class="form-row">
        <div class="form-group">
          <label>Overall Score:</label>
          <input type="text" id="overallscore" name="overallscore" th:value="${supplier?.overallscore}" required>
        </div>
        <div class="form-group">
          <label>Performance Status:</label>
          <select id="performancestatus" name="performancestatus" required>
      <option value="">Select status</option>
              <option value="Satisfactory" th:selected="${supplier?.performancestatus == 'Satisfactory'}">Satisfactory</option>
              <option value="Needs Improvement" th:selected="${supplier?.performancestatus == 'Needs Improvement'}">Needs Improvement</option>
              <option value="Unsatisfactory" th:selected="${supplier?.performancestatus == 'Unsatisfactory'}">Unsatisfactory</option>
          </select>
        </div>
        <div class="form-group">
          <label>Action Required:</label>
            <select id="actionrequired" name="actionrequired" required>
				<option value="">Select Action</option>
				<option value="Continue Partnership" th:selected="${supplier?.actionrequired == 'Continue Partnership'}">Continue Partnership</option>
                <option value="Probation" th:selected="${supplier?.actionrequired == 'Probation'}">Probation</option>
                <option value="Termination" th:selected="${supplier?.actionrequired == 'Termination'}">Termination</option>
            </select>
        </div>
      </div>
    

      <!-- four Row -->

      <div class="form-row">
        <div class="form-group">
          <label>Reviewed By:</label>
          <input type="text" id="reviewedby" name="reviewedby" th:value="${supplier?.reviewedby}" required >
        </div>
      </div>

     

   <!-- Five Row  -->
   

   </div>  

 


    <div class="form-actions">
      <button type="button" id="submitBtn" onclick="submitForm()">Submit Evaluation</button>
        <div id="message" class="message"></div>
			                  
    </div>
  







   </form>



   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 
   <script>
    $(document).ready(function() {
          // Auto-fill Supplier details when updating
          var existingsupplieruid = $('#supplieruid').val();
          if (existingsupplieruid) {
            fetchSupplierDetails(existingsupplieruid);
          }
      });
     
    function fetchSupplierDetails(supplieruid) {
       if (!supplieruid) return;
        $.ajax({
      url: '/fetchSupplierDetails',
      method: 'GET',
      data: { supplieruid: supplieruid },
      success: function(response) {
      if (response) {
       $('#suppliername').val(response.suppliername);
       }
       },
        error: function() {
           alert('Error fetching supplier details. Please try again.');
        }
      });
    }
    
    
    
    
    /*function submitForm() {
       
        const formData = new FormData(document.getElementById("supplierForm"));
        const evaluationUID = $("#evaluationuid").val();
        
        let url, successMessage;
        
        if (!evaluationUID) {
            url = "/supplier/save"; // Change to your actual endpoint
            successMessage = "Supplier Evaluation saved successfully!";
        } else {
            url = `/evaluation/update`; // Change to the correct update endpoint
            successMessage = "Supplier Evaluation updated successfully!";
        }
    
        $.ajax({
            url: url,
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                alert(successMessage);
                resetEvaluationForm();
                window.location.href = "/supplierlist"; // Redirect after success
            },
            error: function (xhr, status, error) {
                console.error("Error:", error);
                alert("Error saving Supplier Evaluation. Please try again.");
            }
        });
    }*/
                      
                        
                      function resetEvaluationForm() {
                          $('#supplierForm')[0].reset();
                          $('#evaluationuid').val('');
                          $('#message').text('');
                          $('#form-title').text('Supplier Evaluation');
                          $('#submitBtn').text('Submit');
                      }
    
                      function prefillEvaluationForm(data) {
                          $('#evaluationuid').val(data.evaluationuid);
                          $('#supplieruid').val(data.supplieruid);
                          
                          $('#evaluationperiod').val(data.evaluationperiod);
                          $('#ontimedeliveryrate').val(data.ontimedeliveryrate);
                          $('#qualityrating').val(data.qualityrating);
                          $('#orderaccuracy').val(data.orderaccuracy);
                          $('#responsivenessscore').val(data.responsivenessscore);
                          $('#compliancescore').val(data.compliancescore);
                          $('#overallscore').val(data.overallscore);
                          $('#performancestatus').val(data.performancestatus);
                          $('#actionrequired').val(data.actionrequired);
                          $('#reviewedby').val(data.reviewedby);
    
                          $('#form-title').text('Update Supplier Evaluation');
                          $('#submitBtn').text('Update');
                      }
                      
                      
                    function submitForm() {
                        const formData = new FormData(document.getElementById("supplierForm"));
                        const supplierId = $("#id").val();  // Ensure ID is used for update check
    
                        let url, successMessage;
    
                        if (!supplierId) {
                            url = "/supplier/save";  // Endpoint for saving a new supplier
                            successMessage = "Supplier Evaluation saved successfully!";
                        } else {
                            url = "/supplier/update";   // Endpoint for updating an existing supplier
                            successMessage = "Supplier Evaluation updated successfully!";
                        }
    
                        $.ajax({
                            url: url,
                            type: "POST",
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (response) {
                                alert(successMessage);
                                window.location.href = "/supplierlist";  // Redirect to list page after success
                            },
                            error: function (xhr, status, error) {
                                alert("Error saving Supplier Evaluation. Please try again.");
                            }
                        });
                    }
                    
                    
                    
                      </Script>
</body>
</html>
